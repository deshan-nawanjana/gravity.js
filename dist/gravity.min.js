const Gravity={};Gravity.Scene=class{constructor(t){this.element=document.createElement("gravity"),this.inner=document.createElement("gravity-inner"),this.element.appendChild(this.inner),this.objects=[],this.resistance=.01,this.gravity=10,this.position={x:0,y:0},this.size={x:400,y:300},this.color=null,this.paused=!1,this.type="Scene",_Gravity_.addCursorEvents(this),this.set(t||{})}set(){let t=_Gravity_.getSetOptions(arguments,this);if(null!==t&&null!==t&&"object"==typeof t){if("resistance"in t&&(this.resistance=t.resistance),"gravity"in t&&(this.gravity=t.gravity),"position"in t){this.position=t.position;let e=`translateX(${this.position.x}px) translateY(${this.position.y}px)`;this.inner.style.transform=e}"size"in t&&(this.size=t.size,this.element.style.width=this.size.x+"px",this.element.style.height=this.size.y+"px"),"color"in t&&(this.color=t.color,this.element.style.backgroundColor=this.color||"transparent")}}add(t){this.objects.push(t),this.inner.appendChild(t.element)}remove(t){this.objects=this.objects.filter(e=>e===t),t.element.remove()}render(){return!1===this.paused&&(_Gravity_.updateMotion(this),!0)}pause(){this.element.setAttribute("paused",""),this.paused=!0}play(){this.element.removeAttribute("paused"),this.paused=!1}},Gravity.Object=class{constructor(t){this.element=document.createElement("obj"),this.active=!0,this.friction=.05,this.elasticity=.2,this.velocity={x:0,y:0},this.fixed={x:!1,y:!1},this.weight=50,this.collide=[],this.visible=!0,this.index=0,this.position={x:0,y:0},this.size={x:50,y:50},this.texture=null,this.outline=!1,this.tags=[],this.events=[],this.text="",this.style=null,this.element._gravity=this,this.type="Object",this.set(t||{})}set(){let t=_Gravity_.getSetOptions(arguments,this);null!==t&&null!==t&&"object"==typeof t&&("active"in t&&(this.active=t.active),"friction"in t&&(this.friction=t.friction),"elasticity"in t&&(this.elasticity=t.elasticity),"velocity"in t&&(this.velocity=t.velocity),"fixed"in t&&(this.fixed=t.fixed),"weight"in t&&(this.weight=t.weight),"visible"in t&&(this.visible=t.visible,this.element.style.display=this.visible?"block":"none"),"index"in t&&(this.index=t.index,this.element.style.zIndex=this.index),"position"in t&&(this.position=t.position,this.element.style.left=this.position.x+"px",this.element.style.top=this.position.y+"px"),"size"in t&&(this.size=t.size,this.element.style.width=this.size.x+"px",this.element.style.height=this.size.y+"px"),"texture"in t&&(this.texture=t.texture,this.element.setAttribute("texture",this.texture.id)),"outline"in t&&(this.outline=t.outline,this.outline?!0===this.outline?this.element.style.boxShadow="inset 0px 0px 0px 1px #F00":this.element.style.boxShadow="inset 0px 0px 0px 1px "+this.outline:this.element.style.boxShadow=""),"tags"in t&&(this.tags=t.tags),"text"in t&&(this.text=t.text,this.element.innerHTML=this.text),"style"in t&&(this.style=t.style,this.style?this.element.className=this.style:this.element.removeAttribute("class")))}addEvent(t,e){this.events.push({type:t,callback:e})}clone(...t){let e=new Gravity.Object(this);return e.set(...t),e}},Gravity.Texture=class{constructor(t){this.id=_Gravity_.createID(),this.element=document.createElement("style"),this.color=null,this.image=null,this.opacity=1,this.size={x:"auto",y:"auto"},this.position={x:"center",y:"center"},this.repeat={x:!0,y:!0},this.flip={x:!1,y:!1},this.animation=null,this.duration=1,this.delay=0,this.reverse=!1,this.paused=!1,this.loop=!0,this.type="Texture",document.head.appendChild(this.element),this.set(t||{})}set(){let t=_Gravity_.getSetOptions(arguments,this);null!==t&&("color"in t&&(this.color=t.color),"image"in t&&(this.image=t.image),"opacity"in t&&(this.opacity=t.opacity),"size"in t&&(this.size=t.size),"position"in t&&(this.position=t.position),"repeat"in t&&(this.repeat=t.repeat),"flip"in t&&(this.flip=t.flip),"animation"in t&&(this.animation=t.animation),"duration"in t&&(this.duration=t.duration),"delay"in t&&(this.delay=t.delay),"reverse"in t&&(this.reverse=t.reverse),"paused"in t&&(this.paused=t.paused),"loop"in t&&(this.loop=t.loop),this.element.innerHTML=`[texture="${this.id}"] { background-color: ${this.color||"transparent"}; background-image: ${this.image?`url(${encodeURI(this.image)})`:"none"}; opacity: ${this.opacity?this.opacity:0}; transition-duration: ${this.duration}s; transition-delay: ${this.delay}s; transition-property: background, color, opacity; background-size: ${"number"==typeof this.size.x?this.size.x+"px":this.size.x} ${"number"==typeof this.size.y?this.size.y+"px":this.size.y}; background-repeat: ${this.repeat.x&&this.repeat.y?"repeat":this.repeat.x&&!this.repeat.y?"repeat-x":!this.repeat.x&&this.repeat.y?"repeat-y":"no-repeat"}; transform: scale(${this.flip.x&&this.flip.y?"-1, -1":this.flip.x&&!this.flip.y?"-1, 1":!this.flip.x&&this.flip.y?"1, -1":"1, 1"}); background-position: ${"number"==typeof this.position.x?this.position.x+"px":this.position.x} ${"number"==typeof this.position.y?this.position.y+"px":this.position.y}; animation-name: ${this.animation?this.animation.id:"none"}; animation-duration: ${this.duration}s; animation-delay: ${this.delay}s; animation-direction: ${this.reverse?"reverse":"normal"}; animation-play-state: ${this.paused?"paused":"running"}; animation-iteration-count: ${!0===this.loop?"infinite":!1===this.loop?"1":this.loop}; } `)}clone(...t){let e=new Gravity.Texture(this);return e.set(...t),e}},Gravity.Animation=class{constructor(t){this.id=_Gravity_.createID(),this.element=document.createElement("style"),this.colors=[],this.images=[],this.type="Animation",this.set(t||{}),document.head.appendChild(this.element)}set(){let t=_Gravity_.getSetOptions(arguments,this);null!==t&&("images"in t||"colors"in t)&&(this.images=Object.values(t.images||this.images),this.colors=Object.values(t.colors||this.colors),this.element.innerHTML=` @keyframes ${this.id} { ${this.images.map((t,e,i)=>{let s=this.colors[e];return`${100*e/i.length}% { background-image: ${t?`url(${encodeURI(t)})`:"none"}; background-color: ${s||"transparent"}; }`}).join("\n")} 100% {${(()=>{let t=this.images[0]||"none",e=this.colors[0]||"transparent";return`             background-image: ${t?`url(${encodeURI(t)})`:"none"}; background-color: ${e||"transparent"}; `})()}} } `)}clone(...t){let e=new Gravity.Animation(this);return e.set(...t),e}},Gravity.Loader=class{constructor(){this.load=async(t,e)=>{if("object"==typeof t)return this.loadAll(t,e);if("asset"!==t.split(".").pop().toLowerCase()){let i=await _Gravity_.loadFile(t,"blob",e);return URL.createObjectURL(i)}{let s=null,o=await _Gravity_.loadFile(t,"text",e),l=JSON.parse(o);return"Object"===l.type?(s=new Gravity.Object(l),l.texture&&(s.set("texture",new Gravity.Texture(l.texture)),l.texture.animation&&s.texture.set("animation",new Gravity.Animation(l.texture.animation)))):"Texture"===l.type?(s=new Gravity.Texture(l),l.animation&&s.set("animation",new Gravity.Animation(l.animation))):"Animation"===l.type?s=new Gravity.Animation(l):"Files"===l.type&&(s=l.data),s}},this.loadAll=async(t,e)=>{let i=[],s=(t,e)=>{if("object"==typeof t&&null!==t){let o=Object.keys(t);for(let l=0;l<o.length;l++){let n=o[l];"string"==typeof t[n]?i.push({url:t[n],path:(e+n).split(".")}):s(t[n],e+n+".")}}},o=0,l=0,n=null;s(t,"");for(let a=0;a<i.length;a++){let r=i[a],y=await this.load(r.url,t=>{"function"==typeof e&&(n!==a&&(l+=t.total,n=a),e({loaded:o+t.loaded,total:l,index:a+1,length:i.length,file:r.url,size:t.total}))}),h=t;for(let p=0;p<r.path.length;p++){let c=r.path[p];p===r.path.length-1?h[c]=y:h=h[c]}o=l}return t}}},Gravity.InputMap=class{constructor(){this.keys=[],window.addEventListener("keydown",t=>{let e=1===t.key.length?t.key.toLowerCase():t.key;!1===this.keys.includes(e)&&this.keys.push(e)}),window.addEventListener("keyup",t=>{let e=1===t.key.length?t.key.toLowerCase():t.key;this.keys=this.keys.filter(t=>t!==e)})}every(){let t=1===arguments.length&&Array.isArray(arguments[0])?arguments[0]:Array.from(arguments);return t.every(t=>this.keys.includes(t))}some(){let t=1===arguments.length&&Array.isArray(arguments[0])?arguments[0]:Array.from(arguments);return t.some(t=>this.keys.includes(t))}none(){let t=1===arguments.length&&Array.isArray(arguments[0])?arguments[0]:Array.from(arguments);return!t.some(t=>this.keys.includes(t))}is(t){return this.keys.includes(t)}not(t){return!this.keys.includes(t)}};const _Gravity_={};_Gravity_.getSetOptions=(t,e)=>{let i={};1===t.length&&"object"==typeof t[0]&&null!==t[1]?Object.assign(i,t[0]):2===t.length&&"string"==typeof t[0]?i[t[0]]=t[1]:3===t.length&&"string"==typeof t[0]&&(i[t[0]]={x:t[1],y:t[2]});let s={},o=Object.keys(i);for(let l=0;l<o.length;l++){let n=o[l],a=i[n];e[n]!==a&&(null===e[n]||null===a?s[n]=a:"object"==typeof a&&"x"in a&&"y"in a?(e[n].x!==a.x||e[n].y!==a.y)&&(s[n]=a):s[n]=a)}return 0===Object.keys(s).length?null:s},_Gravity_.createID=()=>{let t=_Gravity_.createID.list,e=null;for(;null===e||t.includes(e);)e="G-"+(Date.now()+parseInt(Math.random()*Date.now()));return t.push(e),e},_Gravity_.createID.list=[],_Gravity_.limitZero=(t,e)=>0===t?t:t>0?t+e<0?0:t+e:t<0?t+e>0?0:t+e:void 0,_Gravity_.isHorizontalBetween=(t,e,i,s)=>e>=s&&e<=i&&t>=s&&t<=i||e>=s&&e<=i&&t>=s&&t>=i||e<=s&&e<=i&&t>=s&&t<=i||e<=s&&e<=i&&t>=s&&t>=i,_Gravity_.isVerticalBetween=(t,e,i,s)=>t<=i&&t<=s&&e>=i&&e<=s||t>=i&&t<=s&&e>=i&&e<=s||t>=i&&t<=s&&e>=i&&e>=s||t<=i&&t<=s&&e>=i&&e>=s,_Gravity_.getCollideState=(t,e,i,s,o,l,n,a)=>({top:_Gravity_.isHorizontalBetween(e,s,l,a)&&t<=n&&i>=n,bottom:_Gravity_.isHorizontalBetween(e,s,l,a)&&i>=o&&t<=o,left:_Gravity_.isVerticalBetween(t,i,o,n)&&s<=l&&e>=l,right:_Gravity_.isVerticalBetween(t,i,o,n)&&e>=a&&s<=a,topRight:l-s>i-o?"A":"B",topLeft:e-a>i-o?"A":"D",bottomLeft:e-a>n-t?"C":"D",bottomRight:l-s>n-t?"C":"B"}),_Gravity_.getCollideValues=(t,e,i)=>{let s=t.weight,o=e.weight,l=t.velocity[i],n=e.velocity[i],a=l*(s-o)/(s+o)+n*(2*o)/(s+o),r=l*(2*s)/(s+o)+n*(s-o)/(s+o);return{u1:l,u2:n,ut:l+n,v1:a,v2:r,vt:a+r}},_Gravity_.updateMotion=t=>{let e=t.objects;for(let i=0;i<e.length;i++){let s=e[i];if(s.active&&(!1===s.fixed.y&&(s.velocity.y+=t.gravity/50),s.position.y+=s.velocity.y,s.fixed.x,s.position.x+=s.velocity.x),_Gravity_.updateCollisions(s,e),s.active&&!1===s.fixed.x){if(s.collide.length>0){let o=s.collide.map(t=>t.friction).reduce((t,e)=>t+e),l=o+s.friction;s.velocity.x>0?s.velocity.x=_Gravity_.limitZero(s.velocity.x,-1*l):s.velocity.x=_Gravity_.limitZero(s.velocity.x,1*l)}s.velocity.x-=s.velocity.x%t.resistance,s.velocity.x=parseFloat(parseFloat(s.velocity.x).toFixed(2)),s.velocity.y=parseFloat(parseFloat(s.velocity.y).toFixed(2))}let n=s.element;s.position.x!==s.position._x&&(n.style.left=s.position.x+"px",s.position._x=s.position.x),s.position.y!==s.position._y&&(n.style.top=s.position.y+"px",s.position._y=s.position.y)}},_Gravity_.updateCollisions=(t,e)=>{let i=[],s=t.position.y,o=t.position.x+t.size.x,l=t.position.y+t.size.y,n=t.position.x;for(let a=0;a<e.length;a++){let r=e[a];if(t===r)continue;let y=r.position.y,h=r.position.x+r.size.x,p=r.position.y+r.size.y,c=r.position.x,d=_Gravity_.getCollideState(s,o,l,n,y,h,p,c);if(t.active&&r.active){let x={top(){(!1===t.fixed.y||!1===t.fixed.y)&&(t.position.y=y-t.size.y);let e=_Gravity_.getCollideValues(t,r,"y");!1===t.fixed.y&&!1===r.fixed.y?(t.velocity.y=e.v1*t.elasticity,r.velocity.y=e.v2*r.elasticity):!1===t.fixed.y&&!0===r.fixed.y?t.velocity.y=-1*e.ut*t.elasticity:!0===t.fixed.y&&!1===r.fixed.y&&t.velocity.y>0&&(r.velocity.y=-1*e.ut*r.elasticity)},bottom(){(!1===t.fixed.y||!1===t.fixed.y)&&(t.position.y=p);let e=_Gravity_.getCollideValues(t,r,"y");!1===t.fixed.y&&!1===r.fixed.y?(t.velocity.y=e.v1*t.elasticity,r.velocity.y=e.v2*r.elasticity):!1===t.fixed.y&&!0===r.fixed.y?t.velocity.y=e.ut*t.elasticity:!0===t.fixed.y&&!1===r.fixed.y&&t.velocity.y>0&&(r.velocity.y=e.ut*r.elasticity)},left(){(!1===t.fixed.x||!1===t.fixed.y)&&(t.position.x=c-t.size.x);let e=_Gravity_.getCollideValues(t,r,"x");!1===t.fixed.x&&!1===r.fixed.x?(t.velocity.x=e.v1*t.elasticity,r.velocity.x=e.v2*r.elasticity):!1===t.fixed.x&&!0===r.fixed.x?t.velocity.x=e.vt*t.elasticity:!0===t.fixed.x&&!1===r.fixed.x&&t.velocity.x>0&&(r.velocity.x=e.vt*r.elasticity)},right(){(!1===t.fixed.x||!1===t.fixed.y)&&(t.position.x=h);let e=_Gravity_.getCollideValues(t,r,"x");!1===t.fixed.x&&!1===r.fixed.x?(t.velocity.x=e.v1*t.elasticity,r.velocity.x=e.v2*r.elasticity):!1===t.fixed.x&&!0===r.fixed.x?t.velocity.x=e.vt*t.elasticity:!0===t.fixed.x&&!1===r.fixed.x&&t.velocity.x>0&&(r.velocity.x=e.vt*r.elasticity)}};!d.top||d.right||d.bottom||d.left||x.bottom(),d.top||d.right||!d.bottom||d.left||x.top(),d.top||!d.right||d.bottom||d.left||x.left(),d.top||d.right||d.bottom||!d.left||x.right(),d.top&&!d.right&&d.bottom&&d.left&&x.right(),d.top&&d.right&&d.bottom&&!d.left&&x.left(),!d.top&&d.right&&d.bottom&&d.left&&x.top(),d.top&&d.right&&!d.bottom&&d.left&&x.bottom(),d.top&&d.right&&!d.bottom&&!d.left&&("C"===d.bottomLeft?x.bottom():x.left()),d.top&&!d.right&&!d.bottom&&d.left&&("C"===d.bottomRight?x.bottom():x.right()),!d.top&&!d.right&&d.bottom&&d.left&&("A"===d.topRight?x.top():x.right()),!d.top&&d.right&&d.bottom&&!d.left&&("A"===d.topLeft?x.top():x.left())}(d.top||d.right||d.bottom||d.left)&&i.push(r)}let u=t.events.filter(t=>"collidestart"===t.type);if(u.length>0){let v=i.filter(e=>!1===t.collide.includes(e));for(let f=0;f<u.length;f++)for(let m=0;m<v.length;m++)u[f].callback({type:"collidestart",object:v[m],timeStamp:Date.now()})}let g=t.events.filter(t=>"collide"===t.type);if(g.length>0){let $=i.filter(e=>t.collide.includes(e));for(let b=0;b<g.length;b++)for(let _=0;_<$.length;_++)g[b].callback({type:"collide",object:$[_],timeStamp:Date.now()})}let G=t.events.filter(t=>"collideend"===t.type);if(G.length>0){let w=t.collide.filter(t=>!1===i.includes(t));for(let k=0;k<G.length;k++)for(let z=0;z<w.length;z++)G[k].callback({type:"collide",object:w[z],timeStamp:Date.now()})}let j=t.collide.filter(t=>t.active),C=i.filter(t=>t.active),A=t.events.filter(t=>"floatstart"===t.type);if(A.length>0&&0===C.length&&j.length>0)for(let S=0;S<A.length;S++)A[S].callback({type:"floatstart",object:t,timeStamp:Date.now()});let L=t.events.filter(t=>"float"===t.type);if(L.length>0&&0===C.length&&0===j.length)for(let E=0;E<L.length;E++)L[E].callback({type:"float",object:t,timeStamp:Date.now()});let T=t.events.filter(t=>"floatend"===t.type);if(T.length>0&&C.length>0&&0===j.length)for(let O=0;O<T.length;O++)T[O].callback({type:"floatend",object:t,timeStamp:Date.now()});t.collide=i},_Gravity_.addCursorEvents=t=>{let e=["click","mousedown","mouseup","mousemove","mouseenter","mouseout"];for(let i=0;i<e.length;i++){let s=e[i];t.element.addEventListener(s,t=>{let e=t.target._gravity;if(e){let i=e.events.filter(t=>t.type===s);for(let o=0;o<i.length;o++)i[o].callback({type:s,object:e,timeStamp:Date.now(),nativeEvent:t})}})}},_Gravity_.loadFile=(t,e="blob",i=()=>{})=>new Promise((s,o)=>{let l=new XMLHttpRequest;l.open("GET",t),l.responseType=e,l.addEventListener("load",t=>{s(t.currentTarget.response)}),l.addEventListener("progress",t=>{i({loaded:t.loaded,total:t.total})}),l.addEventListener("error",o),l.send()}); (() => { const e = document.createElement('style'); e.innerHTML = `gravity { display: block; width: 400px; height: 300px; overflow: hidden; user-select: none; outline: none; -webkit-tap-highlight-color: transparent; } gravity-inner { position: absolute; } gravity-inner > obj { display: block; position: absolute; left: 0px; top: 0px; width: 50px; height: 50px; } gravity[paused] obj { animation-play-state: paused !important; } gravity-cache > img { width: 10px; height: 10px; opacity: 0; z-index: -1; top: 0px; left: 0px; position: fixed; }`; document.head.appendChild(e) })()